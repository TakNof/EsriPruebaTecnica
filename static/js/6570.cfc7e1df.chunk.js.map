{"version":3,"file":"static/js/6570.cfc7e1df.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/layers/KnowledgeGraphLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import t from\"../core/Collection.js\";import i from\"../core/Error.js\";import a from\"../core/Logger.js\";import{property as s}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import\"../core/RandomLCG.js\";import{subclass as o}from\"../core/accessorSupport/decorators/subclass.js\";import n from\"./Layer.js\";import{KnowledgeGraphLayerDataManager as r}from\"./knowledgeGraph/KnowledgeGraphLayerDataManager.js\";import p from\"./knowledgeGraph/KnowledgeGraphSublayer.js\";import{BlendLayer as h}from\"./mixins/BlendLayer.js\";import{ScaleRangeLayer as d}from\"./mixins/ScaleRangeLayer.js\";import{fetchKnowledgeGraph as l}from\"../rest/knowledgeGraphService.js\";import y from\"../rest/knowledgeGraph/EntityType.js\";import m from\"../rest/knowledgeGraph/RelationshipType.js\";const c=(e,t,i)=>(e.has(t)||e.set(t,i()),e.get(t));let g=class extends(h(d(n))){constructor(e){super(e),this._graphTypeLookup=new Map,this.dataManager=null,this.knowledgeGraph=null,this.layers=new t,this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new t,this.type=\"knowledge-graph\",this._originalInclusionList=e.inclusionModeDefinition}normalizeCtorArgs(e){return{url:e.url,title:e.title}}load(){return this.addResolvingPromise(l(this.url).then((e=>{this._initializeLayerProperties({knowledgeGraph:e,inclusionModeDefinition:this._originalInclusionList}),this.loadLayerAssumingLocalCache()}))),Promise.resolve(this)}_initializeLayerProperties(e){const t=new Set;let s=[],o=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new i(\"knowledge-graph:composite-layer-constructor\",\"If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined\");e.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.inclusionModeDefinition?.generateAllSublayers?(s=e.knowledgeGraph.dataModel.entityTypes??[],o=e.knowledgeGraph.dataModel.relationshipTypes??[]):e.inclusionModeDefinition?.namedTypeDefinitions&&e.inclusionModeDefinition?.namedTypeDefinitions.size>0?e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((i,n)=>{if(!this._graphTypeLookup.get(n))return a.getLogger(this).warn(`A named type, ${n}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(n);this._graphTypeLookup.get(n)instanceof m||\"strictOrigin\"in this._graphTypeLookup.get(n)?t.has(n)||(t.add(n),o.push(this._graphTypeLookup.get(n))):this._graphTypeLookup.get(n)instanceof y||\"properties\"in this._graphTypeLookup.get(n)?t.has(n)||(t.add(n),s.push(this._graphTypeLookup.get(n))):(a.getLogger(this).warn(`A named type, ${n}, was in the inclusion list that wasn't properly modeled and will be removed`),e.inclusionModeDefinition?.namedTypeDefinitions.delete(n))})):(s=e.knowledgeGraph.dataModel.entityTypes??[],o=e.knowledgeGraph.dataModel.relationshipTypes??[]);const n=new r({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=s,this.memberRelationshipTypes=o,this.dataManager=n}_refreshNamedTypes(){for(const e of this.layers)e.emit(\"refresh\",{dataChanged:!0});for(const e of this.tables)e.emit(\"refresh\",{dataChanged:!0})}async _handleNewRecords(e){const t=[];this.dataManager.addToLayer(e);for(const i of e)this.sublayerIdsCache.has(i.typeName)||(this.sublayerIdsCache.set(i.typeName,new Set),t.push(i.typeName)),this.sublayerIdsCache.get(i.typeName).add(i.id);for(const i of t)if(this._graphTypeLookup.has(i)){const e=this._graphTypeLookup.get(i),t=\"endPoints\"in e?\"relationship\":\"entity\",a=new p({objectType:e,parentCompositeLayer:this,graphType:t,title:i});\"entity\"===t?this.dataManager.entityTypeNames.add(i):this.dataManager.relationshipTypeNames.add(i),a.geometryType?this.layers.push(a):this.tables.push(a),this.dataManager.sublayerCaches.set(i,new Map)}this._refreshNamedTypes()}loadLayerAssumingLocalCache(){this.memberEntityTypes.forEach((e=>{const t=new p({objectType:e,parentCompositeLayer:this,graphType:\"entity\",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberRelationshipTypes.forEach((e=>{const t=new p({objectType:e,parentCompositeLayer:this,graphType:\"relationship\",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{const i=c(this.sublayerIdsCache,t,(()=>new Set));e.members?.forEach((e=>{i.add(e.id)}))}))}async addRecords(e){await this._handleNewRecords(e)}async removeRecords(e){const t=[];for(const i of e)!1===this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(i.typeName)?.useAllData&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(i.typeName)?.members?.has(i.id)&&t.push(i);this.dataManager.removeFromLayer(t);for(const i of t)this.sublayerIdsCache.get(i.typeName)?.delete(i.id);return this._refreshNamedTypes(),t}};e([s()],g.prototype,\"dataManager\",void 0),e([s()],g.prototype,\"knowledgeGraph\",void 0),e([s()],g.prototype,\"layers\",void 0),e([s()],g.prototype,\"memberEntityTypes\",void 0),e([s()],g.prototype,\"memberRelationshipTypes\",void 0),e([s()],g.prototype,\"sublayerIdsCache\",void 0),e([s()],g.prototype,\"tables\",void 0),e([s({json:{read:!1}})],g.prototype,\"type\",void 0),g=e([o(\"esri.layers.KnowledgeGraphLayer\")],g);const u=g;export{u as default};\n"],"names":["g","h","d","n","constructor","e","super","this","_graphTypeLookup","Map","dataManager","knowledgeGraph","layers","t","memberEntityTypes","memberRelationshipTypes","sublayerIdsCache","tables","type","_originalInclusionList","inclusionModeDefinition","normalizeCtorArgs","url","title","load","addResolvingPromise","l","then","_initializeLayerProperties","loadLayerAssumingLocalCache","Promise","resolve","_e$knowledgeGraph$dat","_e$knowledgeGraph$dat2","_e$inclusionModeDefin","_e$knowledgeGraph$dat3","_e$knowledgeGraph$dat4","_e$inclusionModeDefin2","_e$inclusionModeDefin3","_e$inclusionModeDefin4","_e$knowledgeGraph$dat5","_e$knowledgeGraph$dat6","Set","s","o","namedTypeDefinitions","size","i","dataModel","entityTypes","forEach","name","set","relationshipTypes","generateAllSublayers","_e$inclusionModeDefin5","_e$inclusionModeDefin6","get","a","getLogger","warn","concat","delete","m","has","add","push","y","r","_refreshNamedTypes","emit","dataChanged","_handleNewRecords","addToLayer","typeName","id","p","objectType","parentCompositeLayer","graphType","entityTypeNames","relationshipTypeNames","geometryType","sublayerCaches","_this$dataManager$inc","_this$dataManager$inc2","_e$members","c","members","addRecords","removeRecords","_this$dataManager$inc3","_this$dataManager$inc4","useAllData","removeFromLayer","_this$sublayerIdsCach","prototype","json","read","u"],"sourceRoot":""}