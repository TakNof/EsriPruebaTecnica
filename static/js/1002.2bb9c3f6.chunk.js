"use strict";(self.webpackChunkweb_arcgis_app=self.webpackChunkweb_arcgis_app||[]).push([[1002],{71002:(e,t,a)=>{a.r(t),a.d(t,{default:()=>F});var i=a(35143),n=(a(35238),a(94643)),o=a(50076),s=a(76460),r=a(50346),l=a(46053),h=(a(81806),a(47249),a(85842)),d=a(25515),u=a(98618),p=a(1484),y=a(68705),c=a(83716),g=a(52451),f=a(65624),m=a(5682),C=a(28899);let v,L=null;function k(){return v||(v=a.e(3884).then(a.bind(a,83884)).then((e=>e.l)).then((e=>{let{default:t}=e;return t({locateFile:e=>(0,C.s)("esri/libs/linkchartlayout/".concat(e))})})).then((e=>{!function(e){L=e}(e)})),v)}var M,b,w;function E(e,t,a,i,n,o){const s=a.length,r=n.length,l=Float64Array.BYTES_PER_ELEMENT,h=Uint32Array.BYTES_PER_ELEMENT,d=Uint8Array.BYTES_PER_ELEMENT,u=15+s*(d+2*l)+r*(2*h),p=L._malloc(u);try{const d=p+16-p%16,u=d+s*l,y=u+s*l,c=y+r*h,g=c+r*h,f=()=>[L.HEAPF64.subarray(d>>3,(d>>3)+s),L.HEAPF64.subarray(u>>3,(u>>3)+s),L.HEAPU32.subarray(y>>2,(y>>2)+r),L.HEAPU32.subarray(c>>2,(c>>2)+r),L.HEAPU8.subarray(g,g+s)],[m,C,v,k,M]=f();m.set(a),C.set(i),v.set(n),k.set(o),M.set(t);let b=e(s,g,d,u,r,y,c),w=null;if(b){const e=L.getLayoutLinksTypes(),t=L.getLayoutLinksVerticesEndIndices(),a=L.getLayoutLinksVertices(),i=L.countLayoutLinksVertices();!r||e&&t?i&&!a?b=!1:w={types:new Uint8Array(L.HEAPU8.subarray(e,e+r)),vertexEndIndex:new Uint32Array(L.HEAPU32.subarray(t>>2,(t>>2)+r)),vertices:new Float64Array(L.HEAPF64.subarray(a>>3,(a>>3)+2*i))}:b=!1}const[E,D,T,x,A]=f();return a.set(E),i.set(D),n.set(T),o.set(x),t.set(A),{success:b,links:w}}finally{L._free(p),L.cleanupLayout()}}(w=M||(M={}))[w.None=0]="None",w[w.IsMovable=1]="IsMovable",w[w.IsGeographic=2]="IsGeographic",w[w.IsRoot=4]="IsRoot",function(e){e[e.Regular=0]="Regular",e[e.Orthogonal=1]="Orthogonal",e[e.Curved=2]="Curved",e[e.Recursive=3]="Recursive"}(b||(b={}));var D,T,x,A,N,_,R,I;!function(e){e.getMinIdealEdgeLength=function(){return L.getMinIdealEdgeLength()},e.apply=function(e,t,a,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return E(((e,t,a,i,n,l,h)=>L.applyForceDirectedLayout(e,t,a,i,n,l,h,o,s,r)),e,t,a,i,n)}}(D||(D={})),function(e){e.apply=function(e,t,a,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return E(((e,t,a,i,n,l,h)=>L.applyCommunityLayout(e,t,a,i,n,l,h,o,s,r)),e,t,a,i,n)}}(T||(T={})),function(e){e.apply=function(e,t,a,i,n){return E(L.applySimpleLayout,e,t,a,i,n)}}(x||(x={})),function(e){e.apply=function(e,t,a,i,n){return E(L.applyHierarchicalLayout,e,t,a,i,n)}}(A||(A={})),function(e){e.apply=function(e,t,a,i,n){return E(L.applyRadialTreeLayout,e,t,a,i,n)}}(N||(N={})),function(e){e.apply=function(e,t,a,i,n){return E(L.applySmartTreeLayout,e,t,a,i,n)}}(_||(_={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(R||(R={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(I||(I={}));var P=a(35877),G=a(46801),Z=a(84252),U=a(76797),S=a(13904),z=a(23701);let H=class extends((0,f.d)((0,m.j)(d.A))){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE"},this._graphTypeLookup=new Map,this.dataManager=null,this.knowledgeGraph=null,this.layers=new n.A,this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map,this.linkChartExtent=new U.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new n.A,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new o.A("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){var t,a,i,n,r,l,h,d,u,p;if(!this.title&&this.url){const e=this.url.split("/");this.title=e[e.length-2]}const c=new Set;let g=[],f=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new o.A("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");null!==(t=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==t&&t.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),null!==(a=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==a&&a.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),null!==(i=e.inclusionModeDefinition)&&void 0!==i&&i.generateAllSublayers?(g=null!==(n=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==n?n:[],f=null!==(r=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==r?r:[]):null!==(l=e.inclusionModeDefinition)&&void 0!==l&&l.namedTypeDefinitions&&(null===(h=e.inclusionModeDefinition)||void 0===h?void 0:h.namedTypeDefinitions.size)>0?null===(d=e.inclusionModeDefinition)||void 0===d||d.namedTypeDefinitions.forEach(((t,a)=>{var i,n;if(!this._graphTypeLookup.get(a))return s.A.getLogger(this).warn("A named type, ".concat(a,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(i=e.inclusionModeDefinition)||void 0===i||i.namedTypeDefinitions.delete(a));this._graphTypeLookup.get(a)instanceof Z.A||"strictOrigin"in this._graphTypeLookup.get(a)?c.has(a)||(c.add(a),f.push(this._graphTypeLookup.get(a))):this._graphTypeLookup.get(a)instanceof G.A||"properties"in this._graphTypeLookup.get(a)?c.has(a)||(c.add(a),g.push(this._graphTypeLookup.get(a))):(s.A.getLogger(this).warn("A named type, ".concat(a,", was in the inclusion list that wasn't properly modeled and will be removed")),null===(n=e.inclusionModeDefinition)||void 0===n||n.namedTypeDefinitions.delete(a))})):(g=null!==(u=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==u?u:[],f=null!==(p=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==p?p:[]);const m=new y.PB({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=g,this.memberRelationshipTypes=f,this.dataManager=m}load(e){return this.addResolvingPromise(new Promise((t=>{(0,P.fetchKnowledgeGraph)(this.url).then((a=>{var i,n,o,s;if(this._initializeLayerProperties({knowledgeGraph:a,inclusionModeDefinition:this._originalInclusionList}),null!==(i=this.dataManager.inclusionModeDefinition)&&void 0!==i&&null!==(i=i.namedTypeDefinitions)&&void 0!==i&&i.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},null!==(n=this.dataManager.knowledgeGraph.dataModel.entityTypes)&&void 0!==n&&n.forEach((e=>{var t;e.name&&(null===(t=this.dataManager.inclusionModeDefinition)||void 0===t||t.namedTypeDefinitions.set(e.name,{useAllData:!0}))})),null!==(o=this.dataManager.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==o&&o.forEach((e=>{var t;e.name&&(null===(t=this.dataManager.inclusionModeDefinition)||void 0===t||t.namedTypeDefinitions.set(e.name,{useAllData:!0}))}))),this.dataPreloadedInLocalCache)this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),null===(s=this.dataManager.inclusionModeDefinition)||void 0===s||s.namedTypeDefinitions.forEach((e=>{var t;e.useAllData=!1,null!==(t=e.members)&&void 0!==t&&t.forEach((e=>{let t;t=e.linkChartLocation instanceof p.A?e.linkChartLocation:e.linkChartLocation?(0,u.Ux)(e.linkChartLocation):null,t&&2===t.coords.length&&0===t.lengths.length?this.entityLinkChartDiagramLookup.set(e.id,t):this.relationshipLinkChartDiagramLookup.set(e.id,t)})),this.addResolvingPromise(this._initializeDiagram().then((async()=>{this.layers.forEach((async e=>{await e.refreshCachedQueryEngine()})),this.tables.forEach((async e=>{await e.refreshCachedQueryEngine()}))})))}));else{var l;const t="GEOGRAPHIC"===(null===(l=this.defaultLinkChartConfig)||void 0===l?void 0:l.layoutMode);this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,t,!0).then((async()=>{(0,r.Te)(e);const t=[],a=[];this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1,this.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((e=>{e.useAllData=!1}))),await this._initializeDiagram(),this.layers.forEach((e=>{a.push(e.refreshCachedQueryEngine()),t.push(new Promise((t=>{e.on("layerview-create",(()=>{t(null)}))})))})),this.tables.forEach((e=>{a.push(e.refreshCachedQueryEngine())})),await Promise.all(a)})))}t(null)}))}))),Promise.resolve(this)}async addRecords(e,t){let a=[];(null===t||void 0===t?void 0:t.cascadeAddRelationshipEndNodes)&&this.dataManager.knowledgeGraph.dataModel&&(a=await(0,g.aq)(e,this.dataManager.knowledgeGraph));const i=e.concat(a).filter((e=>{var t;return!(null!==(t=this.sublayerIdsCache.get(e.typeName))&&void 0!==t&&t.has(e.id))}));await this._handleNewRecords(i)}async removeRecords(e){let{cascadeRemoveRelationships:t=!0,recalculateLayout:a=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{cascadeRemoveRelationships:!0,recalculateLayout:!1},i=[];for(const l of e){var n,o;!1===(null===(n=this.dataManager.inclusionModeDefinition)||void 0===n||null===(n=n.namedTypeDefinitions)||void 0===n||null===(n=n.get(l.typeName))||void 0===n?void 0:n.useAllData)&&(null===(o=this.dataManager.inclusionModeDefinition)||void 0===o||null===(o=o.namedTypeDefinitions)||void 0===o||null===(o=o.get(l.typeName))||void 0===o||null===(o=o.members)||void 0===o?void 0:o.has(l.id))&&i.push(l)}if(t){const e=new Set,t=[];for(const a of i)if(this.dataManager.nodeConnectionsLookup.has(a.id))for(const t of this.dataManager.nodeConnectionsLookup.get(a.id))e.add(t);for(const a of e)if(this.dataManager.memberIdTypeLookup.has(a))for(const e of this.dataManager.memberIdTypeLookup.get(a))this.dataManager.relationshipTypeNames.has(e)&&t.push({id:a,typeName:e});i=i.concat(t)}this.dataManager.removeFromLayer(i);for(const l of i){var s;null!==(s=this.sublayerIdsCache.get(l.typeName))&&void 0!==s&&s.delete(l.id),this.dataManager.relationshipTypeNames.has(l.typeName)?this.relationshipLinkChartDiagramLookup.delete(l.id):this.entityLinkChartDiagramLookup.delete(l.id)}a&&await this.calculateLinkChartLayout(this._currentLinkChartConfig.layoutMode,{});const r=[];return this.layers.forEach((e=>{r.push(e.refreshCachedQueryEngine())})),await Promise.all(r),this._refreshNamedTypes(),i}async expand(e,t){const a=await this.dataManager.getConnectedRecordIds(e,t),i=a.filter((e=>{var t;return!(null!==(t=this.sublayerIdsCache.get(e.typeName))&&void 0!==t&&t.has(e.id))}));return await this._handleNewRecords(a),{records:i}}loadLayerAssumingLocalCache(){var e,t;this.memberRelationshipTypes.forEach((e=>{const t=new c.A({objectType:e,parentCompositeLayer:this,graphType:"relationship",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberEntityTypes.forEach((e=>{const t=new c.A({objectType:e,parentCompositeLayer:this,graphType:"entity",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),(null===(e=this.dataManager.inclusionModeDefinition)||void 0===e?void 0:e.namedTypeDefinitions)&&(null===(t=this.dataManager.inclusionModeDefinition)||void 0===t||t.namedTypeDefinitions.forEach(((e,t)=>{var a;const i=((e,t,a)=>(e.has(t)||e.set(t,a()),e.get(t)))(this.sublayerIdsCache,t,(()=>new Set));null===(a=e.members)||void 0===a||a.forEach((e=>{if(i.add(e.id),e.linkChartLocation)if(e.linkChartLocation instanceof p.A)this.dataManager.relationshipTypeNames.has(t)?this.relationshipLinkChartDiagramLookup.set(e.id,e.linkChartLocation):this.entityLinkChartDiagramLookup.set(e.id,e.linkChartLocation);else{const a=(0,u.Ux)(e.linkChartLocation);this.dataManager.relationshipTypeNames.has(t)?this.relationshipLinkChartDiagramLookup.set(e.id,e.linkChartLocation?a:null):this.entityLinkChartDiagramLookup.set(e.id,e.linkChartLocation?a:null)}}))})))}async calculateLinkChartLayout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"RADIAL_TREE",t=arguments.length>1?arguments[1]:void 0;const a=[],i=[],n=[];this.dataManager.sublayerCaches.forEach(((e,t)=>{this.dataManager.entityTypeNames.has(t)?e.forEach((e=>{a.push({typeName:t,feature:e})})):this.dataManager.relationshipTypeNames.has(t)&&e.forEach((e=>{i.push({typeName:t,feature:e})}))})),this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map;const r=new Map,l=new Map,h=new Map,d=new Map,p=new Uint8Array(a.length),c=new Float64Array(a.length),g=new Float64Array(a.length),f=new Uint32Array(i.length),m=new Uint32Array(i.length),C=[],v=new U.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let L,w="FORCE_DIRECTED",E=0,R=0;switch(w="GEOGRAPHIC"===e?"FORCE_DIRECTED":e,w){case"FORCE_DIRECTED":L=D.apply;break;case"COMMUNITY":L=T.apply;break;case"HIERARCHICAL":L=A.apply;break;case"RADIAL_TREE":L=N.apply;break;case"SMART_TREE":L=_.apply;break;default:L=x.apply}a.forEach((a=>{var i,n,o,s,r,l;let{typeName:h,feature:u}=a;if(null!==t&&void 0!==t&&null!==(i=t.lockedNodeLocations)&&void 0!==i&&i.has(u.attributes[y.yC])){"GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(h)?p[E]=M.IsGeographic:p[E]=M.None;const a=t.lockedNodeLocations.get(u.attributes[y.yC]);c[E]=a.x,g[E]=a.y}else if("GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(h)){var f;p[E]=M.IsGeographic;let e=null;const t=u.attributes[this.dataManager.geographicLookup.get(h).name];switch(null===(f=this.dataManager.geographicLookup.get(h))||void 0===f?void 0:f.geometryType){case"esriGeometryPoint":c[E]=null===t||void 0===t?void 0:t.x,g[E]=null===t||void 0===t?void 0:t.y;break;case"esriGeometryPolygon":e=null===t||void 0===t?void 0:t.centroid,null!=(null===(n=e)||void 0===n?void 0:n.x)&&null!=(null===(o=e)||void 0===o?void 0:o.y)?(c[E]=e.x,g[E]=e.y):p[E]=M.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":e=null===t||void 0===t||null===(s=t.extent)||void 0===s?void 0:s.center,null!=(null===(r=e)||void 0===r?void 0:r.x)&&null!=(null===(l=e)||void 0===l?void 0:l.y)?(c[E]=e.x,g[E]=e.y):p[E]=M.IsMovable;break;default:p[E]=M.IsMovable}(null==c[E]||null==g[E]||Number.isNaN(c[E])||Number.isNaN(g[E]))&&(p[E]=M.IsMovable,c[E]=0,g[E]=0)}else p[E]=M.IsMovable,c[E]=0,g[E]=0;d.set(u.attributes[y.yC],E),C[E]={feature:u,typeName:h},E++}));let I=!1;const P=new Map;i.forEach((e=>{const t=e.feature.attributes[y.Vr],a=e.feature.attributes[y.ZL],i=d.get(t),o=d.get(a);if(void 0!==i&&void 0!==o){const s=t+"-"+a,r=P.get(s);(null===r||void 0===r?void 0:r.has(e.typeName))||(f[R]=i,m[R]=o,void 0===r?P.set(s,new Map([[e.typeName,R]])):r.set(e.typeName,R),R++),n.push(e)}else I=!0,this.relationshipLinkChartDiagramLookup.set(t,null)})),I&&s.A.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),await k();const{success:G,links:Z}=L(p,c,g,f.subarray(0,R),m.subarray(0,R));if(!G)throw new o.A("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let o=0;o<C.length;o++){if(g[o]>84.9999?g[o]=84.9999:g[o]<-84.9999&&(g[o]=-84.9999),c[o]>179.9999?c[o]=179.9999:c[o]<-179.9999&&(c[o]=-179.9999),C[o].feature.attributes[y.sZ]=new S.A(c[o],g[o]),r.has(C[o].typeName)){const e=r.get(C[o].typeName);null===e||void 0===e||e.set(C[o].feature.attributes[y.yC],C[o].feature)}else{const e=new Map;e.set(C[o].feature.attributes[y.yC],C[o].feature),r.set(C[o].typeName,e)}h.set(C[o].feature.attributes[y.yC],C[o].feature);const e=(0,u.Ux)(C[o].feature.attributes[y.sZ]);this.entityLinkChartDiagramLookup.set(C[o].feature.attributes[y.yC],C[o].feature.attributes[y.sZ]?e:null),C[o].feature.attributes[y.sZ].x<v.xmin&&(v.xmin=C[o].feature.attributes[y.sZ].x),C[o].feature.attributes[y.sZ].x>v.xmax&&(v.xmax=C[o].feature.attributes[y.sZ].x),C[o].feature.attributes[y.sZ].y<v.ymin&&(v.ymin=C[o].feature.attributes[y.sZ].y),C[o].feature.attributes[y.sZ].y>v.ymax&&(v.ymax=C[o].feature.attributes[y.sZ].y)}if(this.linkChartExtent.xmin=v.xmin,this.linkChartExtent.xmax=v.xmax,this.linkChartExtent.ymin=v.ymin,this.linkChartExtent.ymax=v.ymax,!Z)throw new o.A("knowledge-graph:layout-failed","Attempting to retrieve link geometry from diagram engine failed");const H=new Map,F=new Map,B=new Map,O=new Set;for(let o=0;o<n.length;o++){const e=[],t=n[o],a=t.feature.attributes[y.Vr],i=t.feature.attributes[y.ZL],r=a+"-"+i,p=P.get(r).get(t.typeName),c=0===p?0:null===Z||void 0===Z?void 0:Z.vertexEndIndex[p-1];if(!O.has(p)){var Q,V;if(O.add(p),Z.types[p]===b.Recursive){const t=[Z.vertices[2*c],Z.vertices[2*c+1]],a=[Z.vertices[2*(c+1)],Z.vertices[2*(c+1)+1]],i=[.5*(t[0]+a[0]),.5*(t[1]+a[1])],n=[i[0]-t[0],i[1]-t[1]],o=[i[0]+n[1],i[1]-n[0]],s=[i[0]-n[1],i[1]+n[0]];e.push(t),e.push(o),e.push(a),e.push(s),e.push(t)}else{if(Z.types[p]!==b.Regular){s.A.getLogger(this).warn("A relationship generated an unsupported link geometry type.  It will not be rendered");continue}for(let t=c;t<Z.vertexEndIndex[p];t++)e.push([Z.vertices[2*t],Z.vertices[2*t+1]])}const t=null===(Q=C[d.get(a)])||void 0===Q?void 0:Q.feature.attributes[y.sZ],n=null===(V=C[d.get(i)])||void 0===V?void 0:V.feature.attributes[y.sZ];e[0][0]===t.x&&e[0][1]===t.y||(e[0]=[t.x,t.y]),e[e.length-1][0]===n.x&&e[e.length-1][1]===n.y||(e[e.length-1]=[n.x,n.y]);for(let a=1;a<e.length-1;a++)e[a][1]>85.5?e[a][1]=85.5:e[a][1]<-85.5&&(e[a][1]=-85.5),e[a][0]>179.9999?e[a][0]=179.9999:e[a][0]<-179.9999&&(e[a][0]=-179.9999);H.has(r)?H.get(r).push(e):H.set(r,[e])}const g=H.get(r);F.has(r)||(F.set(r,new Map),B.set(r,new Map));const f=F.get(r),m=B.get(r);f.has(t.typeName)||(f.set(t.typeName,g.shift()),m.set(t.typeName,0));const v=f.get(t.typeName);m.set(t.typeName,m.get(t.typeName)+1);const L=new z.A({paths:v});if(t.feature.attributes[y.sZ]=L,l.has(t.typeName)){const e=l.get(t.typeName);null===e||void 0===e||e.set(t.feature.attributes[y.yC],t.feature)}else{const e=new Map;e.set(t.feature.attributes[y.yC],t.feature),l.set(t.typeName,e)}h.set(t.feature.attributes[y.yC],t.feature);const k=(0,u.Ux)(t.feature.attributes[y.sZ]);this.relationshipLinkChartDiagramLookup.set(t.feature.attributes[y.yC],t.feature.attributes[y.sZ]?k:null)}for(const o of n){var j,Y;o.feature.attributes[y.d4]=null!==(j=null===(Y=B.get(o.feature.attributes[y.Vr]+"-"+o.feature.attributes[y.ZL]))||void 0===Y?void 0:Y.get(o.typeName))&&void 0!==j?j:null}return this._currentLinkChartConfig={layoutMode:e},{nodes:r,links:l,idMap:h}}async applyNewLinkChartLayout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"RADIAL_TREE",t=arguments.length>1?arguments[1]:void 0;const a=[];await this.calculateLinkChartLayout(e,t),this.layers.forEach((e=>{a.push(e.refreshCachedQueryEngine())})),await Promise.all(a),this._refreshNamedTypes()}getCurrentNodeLocations(){var e;const t=new Map;return null!==(e=this.dataManager.inclusionModeDefinition)&&void 0!==e&&null!==(e=e.namedTypeDefinitions)&&void 0!==e&&e.forEach((e=>{var a;null===e||void 0===e||null===(a=e.members)||void 0===a||a.forEach((e=>{const a=e.linkChartLocation;let i;const n=e.id;a&&(i="x"in a?{x:a.x,y:a.y}:{x:a.coords[0],y:a.coords[1]},t.set(n,new S.A({x:i.x,y:i.y})))}))})),t}async synchronizeInclusionListWithCache(){return new Promise((e=>{var t;null!==(t=this.dataManager.inclusionModeDefinition)&&void 0!==t&&t.namedTypeDefinitions.forEach(((e,t)=>{if(e.useAllData=!1,e.members&&e.members.size>0){if(!this.dataManager.sublayerCaches.get(t))return;const a=new Set(Array.from(this.dataManager.sublayerCaches.get(t).keys()));Array.from(e.members.keys()).filter((e=>!a.has(e))).forEach((t=>{var a;null===(a=e.members)||void 0===a||a.delete(t)}))}})),e()}))}async refreshLinkChartCache(e){await this.dataManager.refreshCacheContent(e);const t=[];this.layers.forEach((e=>{t.push(e.refreshCachedQueryEngine())})),await Promise.all(t),this._refreshNamedTypes()}async _handleNewRecords(e){const t=[];this.dataManager.addToLayer(e);for(const a of e)this.sublayerIdsCache.has(a.typeName)||(this.sublayerIdsCache.set(a.typeName,new Set),t.push(a.typeName)),this.sublayerIdsCache.get(a.typeName).add(a.id);for(const a of t)if(this._graphTypeLookup.has(a)){const e=this._graphTypeLookup.get(a),t="endPoints"in e?"relationship":"entity",i=new c.A({objectType:e,parentCompositeLayer:this,graphType:t,title:a});"entity"===t?this.dataManager.entityTypeNames.add(a):this.dataManager.relationshipTypeNames.add(a),i.geometryType?this.layers.push(i):this.tables.push(i),this.dataManager.sublayerCaches.set(a,new Map)}await this.dataManager.refreshCacheContent(e.map((e=>e.id))),await this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode)}async _initializeDiagram(){var e;this.defaultLinkChartConfig?this.defaultLinkChartConfig.doNotRecalculateLayout?(null!==(e=this.dataManager.inclusionModeDefinition)&&void 0!==e&&null!==(e=e.namedTypeDefinitions)&&void 0!==e&&e.forEach(((e,t)=>{var a;null===e||void 0===e||null===(a=e.members)||void 0===a||a.forEach((e=>{const a=e.linkChartLocation;let i;const n=e.id;if(!a)return;i="x"in a?{x:a.x,y:a.y}:{x:a.coords[0],y:a.coords[1]};const o=(0,u.Ux)(i);this.dataManager.relationshipTypeNames.has(t)?this.relationshipLinkChartDiagramLookup.set(n,o):this.entityLinkChartDiagramLookup.set(n,o),this.linkChartExtent.xmin>i.x&&(this.linkChartExtent.xmin=i.x),this.linkChartExtent.xmax<i.x&&(this.linkChartExtent.xmax=i.x),this.linkChartExtent.ymin>i.y&&(this.linkChartExtent.ymin=i.y),this.linkChartExtent.ymax<i.y&&(this.linkChartExtent.ymax=i.y)}))})),this.memberRelationshipTypes.forEach((e=>{var t;e.name&&(null===(t=this.dataManager.sublayerCaches.get(e.name))||void 0===t||t.forEach((e=>{const t=this.relationshipLinkChartDiagramLookup.get(e.attributes[y.Vr]),a=this.relationshipLinkChartDiagramLookup.get(e.attributes[y.ZL]);if(t&&a){const i=(0,u.Ux)(new z.A({paths:[[t.coords[0],t.coords[1]],[a.coords[0],a.coords[1]]]}));this.relationshipLinkChartDiagramLookup.set(e.attributes[y.yC],i)}else this.relationshipLinkChartDiagramLookup.set(e.attributes[y.yC],null)})))}))):await this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{lockedNodeLocations:this.getCurrentNodeLocations()}):await this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()})}_refreshNamedTypes(){for(const e of this.layers)e.emit("refresh",{dataChanged:!0});for(const e of this.tables)e.emit("refresh",{dataChanged:!0})}};(0,i._)([(0,l.MZ)()],H.prototype,"dataPreloadedInLocalCache",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"defaultLinkChartConfig",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"dataManager",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"knowledgeGraph",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"layers",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"entityLinkChartDiagramLookup",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"relationshipLinkChartDiagramLookup",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"linkChartExtent",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"memberEntityTypes",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"memberRelationshipTypes",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"sublayerIdsCache",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"tables",void 0),(0,i._)([(0,l.MZ)({json:{read:!1}})],H.prototype,"type",void 0),H=(0,i._)([(0,h.$)("esri.layers.LinkChartLayer")],H);const F=H}}]);
//# sourceMappingURL=1002.2bb9c3f6.chunk.js.map